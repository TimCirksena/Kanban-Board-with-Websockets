<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
  <link href="../META-INF/resources/styles/style.css" rel="stylesheet">
  <title>My Tiles Page</title>
  <meta charset="UTF-8">
  <style>
    body {
      /* Prevent the user selecting text in the example */
      user-select: none;
    }

    #draggable {
      text-align: center;
      background: white;
    }

    .draggable {
      text-align: center;
      background: white;
      padding: 10px;
      margin: 8px;
    }

    .dropzone {
      display: inline-block;
      float: left;
      width: 200px;
      height: 500px;
      background: blueviolet;
      margin: 10px;
      padding: 10px;
    }

    .dropzone.dragover {
      background-color: purple;
    }

    .list-title {
      background-color: #f1f1f1;
      color: #333333;
      padding: 10px;
    }

    .dragging {
      opacity: 0.5;
    }

    .add-button {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      border-radius: 25px; /* half of width and height */
      background-color: blue;
      color: white;
      font-size: 30px;
      text-align: center;
      line-height: 50px;
      cursor: pointer;
    }

    .add-button:hover {
      background-color: darkblue;
    }
  </style>
</head>
<body>
<button id="add-button" class="add-button">+</button>
<div id="boardKanban">
  <h1>{boardTitel.titel}</h1>

</div>
<script>

  let dragged;
  var id = 2;

  {#for listeKanban in listeKanbans}
  var newListKanbanDiv = createKanbanListElement( "{listeKanban.titel}",{listeKanban.listeId});
  {#for elementKanban in listeKanban.stubElementDTOS}
  newListKanbanDiv.appendChild(createCard("{elementKanban.titel}"));
  {/for}
  {/for}

  function dragzone() {
    /* events fired on the draggable target */
    const sources = document.querySelectorAll(".draggable");
    sources.forEach(source => {
      source.addEventListener("drag", (event) => {
        console.log("dragging");
      });
      source.addEventListener("dragstart", (event) => {
        // store a ref. on the dragged elem
        dragged = event.target;
        // make it half transparent
        event.target.classList.add("dragging");
      });
      source.addEventListener("dragend", (event) => {
        // reset the transparency
        event.target.classList.remove("dragging");
      });
    })
    /* events fired on the drop targets */
    //const target = document.getElementById("droptarget");
    const listTargets = document.querySelectorAll(".dropzone");
    listTargets.forEach(target => {
      target.addEventListener("dragover", (event) => {
        // prevent default to allow drop
        event.preventDefault();
      }, false);
      target.addEventListener("dragenter", (event) => {
        // highlight potential drop target when the draggable element enters it
        if (event.target.classList.contains("dropzone")) {
          event.target.classList.add("dragover");
        }
      });
      target.addEventListener("dragleave", (event) => {
        // reset background of potential drop target when the draggable element leaves it
        if (event.target.classList.contains("dropzone")) {
          event.target.classList.remove("dragover");
        }
      });
      target.addEventListener("drop", (event) => {
        // prevent default action (open as link for some elements)
        event.preventDefault();
        // move dragged element to the selected drop target
        if (event.target.classList.contains("dropzone")) {
          event.target.classList.remove("dragover");
          event.target.appendChild(dragged);
        }
      });
    })
  }

  //New List-Item
  document.getElementById("add-button").addEventListener("click", createKanbanDummy);

  function createKanbanListElement(titel, listeId) {
    // Create new dropzone element
    var newListKanbanDiv = document.createElement("div");
    newListKanbanDiv.classList.add("dropzone");
    newListKanbanDiv.setAttribute("id", "color-picker" + id);
    id++;

    // Create card link
    var cardLink2 = document.createElement("a");
    cardLink2.classList.add("card-link");
    cardLink2.href = "#";
    cardLink2.innerHTML = "ListeID" + listeId;
    newListKanbanDiv.appendChild(cardLink2);

    // Create new h2 element for the title
    var newTitle = document.createElement("h2");
    newTitle.classList.add("list-title");
    newTitle.innerHTML = titel;

    // Create new label for color picker
    var colorPickerLabel = document.createElement("label");
    colorPickerLabel.setAttribute("for", "color-picker");
    colorPickerLabel.innerHTML = "Background color: ";

    // Create new color picker input
    var colorPickerInput = document.createElement("input");
    colorPickerInput.setAttribute("type", "color");
    colorPickerInput.setAttribute("id", "color-picker");
    colorPickerInput.setAttribute("name", "color-picker");
    colorPickerInput.setAttribute("style", "width: 30px; height: 15px;");
    colorPickerInput.addEventListener("change", function () {
      var parent = this.parentElement.parentElement;
      parent.style.backgroundColor = this.value;
    });

    // Append elements to new dropzone element
    newListKanbanDiv.appendChild(newTitle);
    newListKanbanDiv.appendChild(colorPickerLabel);
    colorPickerLabel.appendChild(colorPickerInput);



    // Append new dropzone element to boardKanban div
    document.getElementById("boardKanban").appendChild(newListKanbanDiv);
    dragzone();

    return newListKanbanDiv;
  }

  function createCard(title) {
    // Create card element
    var card = document.createElement("div");
    card.setAttribute("draggable", "true");
    card.classList.add("card", "draggable");
    card.innerHTML = title;
    return card;
  }

  function createKanbanDummy() {
    // Create new dropzone element
    var newDropzone = document.createElement("div");
    newDropzone.classList.add("dropzone");
    newDropzone.setAttribute("id", "color-picker" + id);
    id++;

    // Create new h2 element for the title
    var newTitle = document.createElement("h2");
    newTitle.classList.add("list-title");
    newTitle.innerHTML = "New List Title";

    // Create new label for color picker
    var colorPickerLabel = document.createElement("label");
    colorPickerLabel.setAttribute("for", "color-picker");
    colorPickerLabel.innerHTML = "Background color: ";

    // Create new color picker input
    var colorPickerInput = document.createElement("input");
    colorPickerInput.setAttribute("type", "color");
    colorPickerInput.setAttribute("id", "color-picker");
    colorPickerInput.setAttribute("name", "color-picker");
    colorPickerInput.setAttribute("style", "width: 30px; height: 15px;");
    colorPickerInput.addEventListener("change", function () {
      var parent = this.parentElement.parentElement;
      parent.style.backgroundColor = this.value;
    });

    // Append elements to new dropzone element
    newDropzone.appendChild(newTitle);
    newDropzone.appendChild(colorPickerLabel);
    colorPickerLabel.appendChild(colorPickerInput);

    // Append new dropzone element to boardKanban div
    document.getElementById("boardKanban").appendChild(newDropzone);
    dragzone();

  }

</script>
</body>
</html>